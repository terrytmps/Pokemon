<!-- historique des données-->
{% extends "partials/base.html" %}

{% block content %}
<div class="container mt-4">
    <!-- Sélecteur de période -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Période d'analyse</h5>
        </div>
        <div class="card-body">
            <form class="row g-3">
                <div class="col-md-4">
                    <label for="startDate" class="form-label">Date de début</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="col-md-4">
                    <label for="endDate" class="form-label">Date de fin</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="button" class="btn btn-primary me-2">Appliquer</button>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="quickSelectDropdown" data-bs-toggle="dropdown">
                            Sélection rapide
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Dernière semaine</a></li>
                            <li><a class="dropdown-item" href="#">Dernier mois</a></li>
                            <li><a class="dropdown-item" href="#">Derniers 3 mois</a></li>
                        </ul>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Résumé de la période -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body">
                    <h6 class="card-title">Alertes critiques</h6>
                    <h2 class="card-text">12</h2>
                    <small>+3 par rapport à la période précédente</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h6 class="card-title">Avertissements</h6>
                    <h2 class="card-text">28</h2>
                    <small>-5 par rapport à la période précédente</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h6 class="card-title">Température moyenne</h6>
                    <h2 class="card-text">22.5°C</h2>
                    <small>Stable par rapport à la période précédente</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h6 class="card-title">Temps normal</h6>
                    <h2 class="card-text">85%</h2>
                    <small>+2% par rapport à la période précédente</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphique d'évolution -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Évolution sur la période</h5>
        </div>
        <div class="card-body">
            <canvas id="historyChart" height="100"></canvas>
        </div>
    </div>

    <!-- Tableau des événements -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Journal des événements</h5>
            <button class="btn btn-sm btn-primary">Exporter</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Pièce</th>
                            <th>Événement</th>
                            <th>Température</th>
                            <th>Durée</th>
                            <th>Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>21/01/2025 10:30</td>
                            <td>Chambre</td>
                            <td>Température élevée</td>
                            <td>26.5°C</td>
                            <td>1h 30min</td>
                            <td><span class="badge bg-danger">Alerte</span></td>
                        </tr>
                        <tr>
                            <td>21/01/2025 09:15</td>
                            <td>Cuisine</td>
                            <td>Inactivité prolongée</td>
                            <td>22.0°C</td>
                            <td>2h 45min</td>
                            <td><span class="badge bg-warning">Attention</span></td>
                        </tr>
                        <tr>
                            <td>21/01/2025 08:00</td>
                            <td>Salon</td>
                            <td>Conditions normales</td>
                            <td>21.5°C</td>
                            <td>45min</td>
                            <td><span class="badge bg-success">Normal</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Précédent</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Suivant</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Inclusion de Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Graphique d'évolution
const ctx = document.getElementById('historyChart').getContext('2d');
const historyChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['1 Jan', '2 Jan', '3 Jan', '4 Jan', '5 Jan', '6 Jan', '7 Jan'],
        datasets: [{
            label: 'Alertes',
            data: [2, 3, 1, 4, 2, 3, 2],
            borderColor: 'rgb(255, 99, 132)',
            tension: 0.1
        }, {
            label: 'Avertissements',
            data: [4, 3, 5, 2, 4, 3, 4],
            borderColor: 'rgb(255, 205, 86)',
            tension: 0.1
        }, {
            label: 'Température moyenne',
            data: [22, 21.5, 23, 22.5, 21, 22, 22.5],
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1,
            yAxisID: 'temperature'
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Nombre d\'événements'
                }
            },
            temperature: {
                position: 'right',
                beginAtZero: false,
                title: {
                    display: true,
                    text: 'Température (°C)'
                }
            }
        }
    }
});

// Gestionnaire pour la sélection rapide
document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function(e) {
        e.preventDefault();
        const selectedPeriod = this.textContent;
        // Logique pour définir les dates en fonction de la période sélectionnée
        console.log('Période sélectionnée:', selectedPeriod);
    });
});
</script>

{% endblock %}
